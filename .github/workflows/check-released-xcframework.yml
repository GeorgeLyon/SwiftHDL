name: Check Released XCFramework

on:
  workflow_dispatch:
    inputs:
      binaryTargetURL: 
        type: string
        required: true
        description: URL to the zipped XCFramework
      binaryTargetChecksum:
        type: string
        required: true
        description: checksum to use with the binart target
  pull_request:
    paths:
      - .github/workflows/check-released-xcframework.yml

jobs:
  build-and-test:
    name: Check Released XCFramework
    runs-on: macos-13

    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Switch to Swift 5.9
        run: |
          sudo xcode-select --switch /Applications/Xcode_15.0.1.app/Contents/Developer
          swift --version
      - name: Tweak test project
        run: |
          sed -i'.bak' 's@path.*.xcframework"),@url: "${{ github.event.inputs. binaryTargetURL }}", checksum: "${{ github.event.inputs.binaryTargetChecksum }}"),@' test-projects/TestXCFramework/Package.swift
      - name: Test tweaked test project
        run: |
          swift test --package-path test-projects/TestXCFramework
        